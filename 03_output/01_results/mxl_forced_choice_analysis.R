# Or in the case
# of a Mixed Logit model, the user needs to include a call to a function that averages across draws
# (apollo_avgInterDraws and/or apollo_avgIntraDraws). If calls to these functions are missing
# when needed, or if a user makes a call to a function that should not be used in the specific model,
# the code will fail, and provide the user with feedback about why this happened. This is in our
# view much better than a situation where the software permits users to make mistakes and fixes
# them behind the scenes.

# 6.1.3 Implementation
# We explain the implementation of the model from Section 6.1.2 in four simple steps. We do not
# revisit obvious steps such as the definition of parameters to estimate. The model is implemented in
# Apollo_example_16.r, with simpler Mixed Logit models also available in Apollo_example_14.r
# and Apollo_example_15.r.
# Settings
# The first step is to set mixing=TRUE in apollo_control. This setting is a requirement for using
# continuous random heterogeneity. A user may additionally set nCores to a value larger than 1 in
# apollo_control, a point we return to in Section 6.4. We would thus for example have:
#   apollo_control = list(modelName = "Apollo_example_16";
#                         :::
#                           mixing = TRUE;
#                         nCores = 3)
# Draws
# The second step concerns the generation of draws for random distributions. In our case, we
# need to produce uniformly distributed inter-individual draws for tc;n, normally distributed interindividual
# draws for tt;n and hw;n, and normally distributed intra-individual draws for tt;n;t.
# Draws are generated by Apollo whenever mixing==TRUE in apollo_control, using the settings
# defined in a list called apollo_draws. This process happens during apollo_validateInputs.
# The setup used for this is illustrated in Figure 6.1.
# In apollo_draws, the user needs to create settings for the type of draws, both for inter
# (interDrawsType) and intra-individual (intraDrawsType) draws. Seven pre-defined types of
# draws are available in Apollo, namely:
#   pmc for pseudo-Monte Carlo draws;
# halton for Halton draws Halton (1960), not recommended for more than five random coefficients,
# (cf. Bhat, 2003);
# Chapter 6. Incorporating random heterogeneity 70
# apol lo_draws = l i s t (
#   interDrawsType = " hal ton " ,
#   interNDraws = 100 ,
#   int e rUni fDraws = c (" draws_tc_inter ") ,
#   interNormDraws = c (" draws_hw_inter " ," draws_tt_inter ") ,
#   intraDrawsType = "mlhs " ,
#   intraNDraws = 100 ,
#   int raUni fDraws = c ( ) ,
#   intraNormDraws = c (" draws_tt_intra ")
# )
# Figure 6.1: Defining settings for generation of draws
# mlhs for MLHS draws (Hess et al., 2006);
# sobol for Sobol draws (Sobolâ€™, 1967);
# sobolOwen for Sobol draws with Owen scrambling (Owen, 1995);
# sobolFaureTezuka for Sobol draws with Faure-Tezuka scrambling (Faure and Tezuka, 2000);
# and
# sobolOwenFaureTezuka for Sobol draws with both Owen and Faure-Tezuka scrambling